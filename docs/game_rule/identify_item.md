# 探索逻辑 (Exploration Logic)

该文档描述了 `game/explore_item.js` 中定义的物品探索核心逻辑。

## 1. 核心流程

用户对仓库中的某个战利品进行操作，系统通过 LLM 模拟操作结果，并反馈结果、潜在能力发现情况以及物品损耗。

## 2. 输入与上下文

### 用户操作
- 用户口述对战利品的操作。
- **限制**：
  - 只能使用仓库中的其他物品或身体部位。
  - 操作必须现实、符合逻辑。
  - 不能使用未获得的高科技或魔法。

### 物品组合
- 用户可以尝试组合两个物品。
- 若使用其他物品辅助探索，**两个物品都会受到损伤**。

### 未鉴定物品
- 若物品名称带有 `[?]`（未完全鉴定），LLM 在反馈结果中**不能**提及该物品的具体名字。

## 3. 结果判定 (LLM)

LLM 模拟操作并返回 JSON 格式的结果。

### 发现潜在能力 (Discovery)
- **判定标准**：用户必须在探索过程中找到与某能力极高相关度的线索，且逻辑通顺。
- **限制**：每次探索最多发现 **1 个**能力。
- **上帝干预 (概率)**：
  - **50%** 的概率（`Math.random() < 0.5`），系统会强制设定**本次探索不能发现新能力**，即使用户操作非常接近线索。
  - 旨在增加探索的不确定性和难度。

### 物品损伤 (Damage)
- 每次操作都会对物品造成损伤。
- 损伤值范围：**1 - 10** 点耐久度。
- 若涉及多个物品（如组合操作），所有涉及物品均会扣除耐久度。

### 结果描述 (Result)
- 描述操作的回应和结果。
- 充满不确定性、风险、趣味性和戏剧性。
- 可能包含误导性线索。
- 除非用户真正发现了能力，否则不能直接透露潜在能力信息。

## 4. 状态更新

### 耐久度扣除
- 根据 LLM 返回的 `damage` 字段扣除对应物品的耐久度。
- 若耐久度降至 0 或以下，物品被标记为损坏（系统提示无法继续使用）。

### 能力解锁
- 若 `discovered_ability` 返回有效索引：
  - 将对应能力的 `discovered` 状态设为 `true`。
  - 检查是否所有能力都已发现，若是，则将物品的 `fully_discovered` 设为 `true`。

### 历史记录
- 交互的简要总结 (`summary`) 会被追加到历史记录中，作为下一次探索的上下文。
